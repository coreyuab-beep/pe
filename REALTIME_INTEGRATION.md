# Passive Edge 系统实时联动说明

## 概述

Passive Edge 订单生产测试管理系统实现了全面的模块间实时联动，确保数据的一致性和业务流程的自动化。本系统通过实时通知、状态同步和数据联动，实现了业务流程的无缝衔接。

## 实时联动架构

### 1. 数据流向图

```
┌─────────────┐
│   订单管理   │
└──────┬──────┘
       │
       ├──> 配方管理 (关联配方)
       │
       ├──> 物料管理 (物料领料)
       │
       └──> 配方测试 (质量检测)
              │
              └──> 订单状态更新
```

### 2. 实时通知系统

系统采用中心化的实时通知机制，在发生重要业务事件时自动推送通知：

#### 通知类型

| 通知类型 | 触发条件 | 优先级 | 影响范围 |
|---------|---------|--------|---------|
| 库存预警 | 库存低于最小值 | 高 | 物料管理、订单管理 |
| 缺货预警 | 库存为0 | 高 | 采购部门、生产部门 |
| 订单创建 | 新订单创建 | 中 | 销售部门、生产部门 |
| 订单状态变更 | 订单状态更新 | 中 | 全体相关人员 |
| 测试完成 | 测试任务完成 | 中 | 质检部门、生产部门 |
| 配方更新 | 配方版本更新 | 低 | 研发部门、生产部门 |
| 单据审批 | 入库/出库单审批 | 中 | 仓库、财务部门 |
| 单据拒绝 | 单据审批拒绝 | 高 | 相关部门 |

## 业务流程联动详情

### 流程1: 订单创建 → 物料需求联动

**联动机制:**

1. **订单创建**
   - 创建订单时，关联配方和物料
   - 系统自动计算所需物料数量
   - 检查物料库存是否充足

2. **库存检查**
   - 如果物料充足：订单进入"待生产"状态
   - 如果物料不足：
     - 自动创建库存预警通知
     - 触发采购流程
     - 订单标记为"物料等待"状态

3. **物料领料**
   - 生产开始前，创建出库单
   - 审批通过后，物料出库
   - 实时更新库存数据
   - 订单状态更新为"生产中"

**数据联动:**
```
订单.状态 = "待生产" → 
  物料.库存检查 → 
    库存不足 → 通知.库存预警 → 
      采购流程 → 
        入库单创建 → 
          物料.库存增加 → 
            订单.状态 = "生产中"
```

### 流程2: 测试完成 → 订单状态联动

**联动机制:**

1. **测试发起**
   - 从订单发起测试
   - 关联订单号和配方版本
   - 测试状态: "测试中"

2. **测试进行**
   - 实时记录测试数据
   - 测试曲线可视化展示
   - 中间结果实时更新

3. **测试完成**
   - 所有参数测试完成
   - 生成测试报告
   - 判定测试结果（合格/不合格）

4. **状态联动**
   - 如果测试合格:
     - 订单状态更新为"已完成"
     - 发送通知给相关人员
     - 生成交付通知
   - 如果测试不合格:
     - 订单状态更新为"需返工"
     - 创建问题工单
     - 通知研发部门

**数据联动:**
```
测试.状态 = "测试中" → 
  测试数据记录 → 
    测试完成 → 
      结果判定 → 
        合格 → 订单.状态 = "已完成" → 
          通知.订单完成 → 
            交付流程
        不合格 → 订单.状态 = "需返工" → 
          工单创建 → 
            通知.问题报告
```

### 流程3: 配方更新 → 订单/测试联动

**联动机制:**

1. **配方更新**
   - 创建新配方版本
   - 更新配方参数
   - 标记配方状态

2. **影响分析**
   - 查找使用旧版本的订单
   - 查找基于旧版本的测试
   - 评估影响范围

3. **联动通知**
   - 通知相关订单负责人
   - 通知测试部门
   - 标记需要重新测试的项目

4. **版本切换（可选）**
   - 批量更新订单配方版本
   - 重新生成测试任务
   - 更新生产参数

**数据联动:**
```
配方.版本更新 → 
  影响范围分析 → 
    订单列表（使用旧版本）→ 
      通知.配方更新 → 
        确认是否切换版本 → 
          是 → 批量更新订单配方 → 
            重新测试 → 
              更新生产参数
```

### 流程4: 物料出入库 → 多模块联动

**联动机制:**

1. **入库单创建**
   - 关联供应商和采购单
   - 录入物料明细
   - 提交审批

2. **入库审批**
   - 审批通过:
     - 物料入库
     - 库存实时更新
     - 更新仪表盘统计
     - 检查是否满足等待订单
   - 审批拒绝:
     - 通知供应商
         - 标记入库单为"已拒绝"

3. **库存联动**
   - 库存更新后:
     - 检查低库存预警
     - 检查是否有过期物料
     - 更新物料价值统计
     - 触发等待订单流程

4. **出库单创建**
   - 关联订单或测试
   - 检查库存充足性
   - 提交审批

5. **出库审批**
   - 审批通过:
     - 物料出库
     - 库存实时更新
     - 订单/测试状态更新
   - 审批拒绝:
     - 通知申请人
     - 恢复库存预留

**数据联动:**
```
入库单创建 → 
  审批流程 → 
    通过 → 物料入库 → 
      库存.增加 → 
        仪表盘.更新 → 
          低库存检查 → 
            等待订单.检查 → 
              满足条件 → 订单.状态更新
```

## 实时数据同步策略

### 1. 数据更新频率

| 数据类型 | 更新频率 | 同步方式 |
|---------|---------|---------|
| 订单状态 | 即时 | 推送通知 |
| 库存数据 | 即时 | 实时计算 |
| 测试数据 | 5秒/次 | 定时刷新 |
| 统计数据 | 10秒/次 | 定时刷新 |
| 报表数据 | 1分钟/次 | 定时刷新 |

### 2. 数据一致性保障

- **乐观锁机制**: 防止并发更新冲突
- **事务处理**: 确保关联数据一致性
- **版本控制**: 追踪数据变更历史
- **数据校验**: 自动检测数据异常

### 3. 缓存策略

- **实时数据**: 不使用缓存，直接读取
- **统计数据**: 缓存10秒，定时刷新
- **历史数据**: 缓存1小时，按需刷新
- **报表数据**: 预生成，定时更新

## 用户界面联动

### 1. 仪表盘实时更新

- **实时指标**: 订单数、库存数、测试数
- **动态图表**: 自动刷新数据
- **预警提示**: 实时显示预警信息
- **更新标识**: 显示最后更新时间

### 2. 模块间联动

- **订单 → 配方**: 点击订单可查看关联配方
- **订单 → 测试**: 点击订单可查看相关测试
- **配方 → 订单**: 点击配方可查看使用该配方的订单
- **测试 → 订单**: 测试完成自动更新订单状态

### 3. 通知中心

- **实时提醒**: 重要事件立即推送
- **分类查看**: 按类型筛选通知
- **操作快捷**: 通知中可直接跳转
- **已读管理**: 标记已读/全部已读

## 性能优化

### 1. 前端优化

- **虚拟滚动**: 大数据列表使用虚拟滚动
- **懒加载**: 图表和详情按需加载
- **防抖处理**: 搜索和过滤使用防抖
- **缓存策略**: 组件和API响应缓存

### 2. 后端优化

- **批量操作**: 支持批量数据更新
- **异步处理**: 耗时操作异步执行
- **队列管理**: 使用消息队列处理通知
- **数据库优化**: 索引优化和查询优化

## 监控与日志

### 1. 联动监控

- **状态监控**: 实时监控业务流程状态
- **性能监控**: 监控联动操作性能
- **异常监控**: 自动检测联动异常
- **告警机制**: 异常情况自动告警

### 2. 操作日志

- **完整记录**: 记录所有联动操作
- **可追溯**: 支持操作历史追溯
- **审计报告**: 生成审计报告
- **数据备份**: 定期备份日志数据

## 最佳实践

### 1. 订单管理

- 创建订单时完整填写信息
- 及时关联配方和物料
- 关注库存预警通知
- 跟踪订单状态变化

### 2. 物料管理

- 定期检查库存预警
- 及时处理补货请求
- 规范出入库流程
- 保持物料信息准确

### 3. 测试管理

- 测试前检查设备状态
- 实时记录测试数据
- 及时生成测试报告
- 反馈测试结果

### 4. 系统使用

- 定期查看通知中心
- 及时处理待审批单据
- 关注系统状态指示
- 定期导出重要数据

## 故障处理

### 常见问题

1. **数据不同步**
   - 检查网络连接
   - 刷新页面
   - 联系技术支持

2. **通知未收到**
   - 检查通知设置
   - 确认通知权限
   - 清除浏览器缓存

3. **状态未更新**
   - 等待系统同步
   - 手动刷新数据
   - 检查操作日志

### 应急方案

1. **系统故障**
   - 启用备用系统
   - 通知所有用户
   - 记录故障信息

2. **数据异常**
   - 暂停相关操作
   - 数据备份
   - 恢复数据

3. **联动失败**
   - 检查联动配置
   - 手动触发联动
   - 联系技术支持

## 总结

Passive Edge 系统通过完善的实时联动机制，实现了业务流程的自动化和数据的实时同步，提高了工作效率和数据准确性。用户需要熟悉各个模块的联动关系，合理使用系统功能，确保业务流程顺畅进行。
